{% load mathfilters %}
{% load app_filters %}

{% if apiError %}
    <td colspan="13" style="text-align: center;"><span class="error"><i class="fas fa-skull-crossbones"></i>&nbsp;&nbsp;{{apiError}}</span></td>
{% elif target %}
    <td class="a" title="Last attack on {{target.endTS|ts2date}}"><b {% if not target.respect %}class="error"{% endif %}>{{target.result}}</b></td>
    <!-- <td class="a"><a href="https://www.torn.com/profiles.php?XID={{target.attacker_id}}" target="_blank"> {{target.attacker_name}} [{{target.attacker_id}}]</a></td> -->
    <td class="b dont-touch-me"><a href="https://www.torn.com/profiles.php?XID={{targetId}}" target="_blank"> {{target.targetName}} [{{targetId}}]</a></td>
    <td class="c">{{target.level}}</td>
    <!-- <td class="a">{{target.rank}}</td> -->
    <td class="a">{{target.lastAction}}</td>
    <td class="c">{{target.fairFight|floatformat:2}}</td>
    <td class="c"><b title="{{target.fairFight|floatformat:2}} x 0.25 x (ln({{target.level}}) + 1)">{{target.respect|floatformat:2}}</b></td>
    <!-- <td class="c">{{target.respect|mul:target.fairFight|floatformat:2}}</td> -->
    <td class="d">
        <div class="life-bar" title="{{target.life}}/{{target.lifeMax}}">
            <span style="width: {{target.life|div:target.lifeMax|mul:100|floatformat:0}}%;"></span>
        </div>
    </td>
    <td class='e {% if target.status.0 != "O" %}not-{% endif %}okay'>{{target.status}}</td>
    <td class="f update-timer">
        {% now "U" as ts %}
        {% with seconds=ts|sub:target.lastUpdate%}
            {% with minutes=seconds|intdiv:60 %}
                {% with hours=minutes|intdiv:60 %}
                    {% if hours %}
                        > 1h
                    {% elif minutes > 9 %}
                        {{minutes}} min
                    {% else %}
                        {{ts|sub:target.lastUpdate|mod:600}} s
                    {% endif %}
                {% endwith %}
            {% endwith %}
        {% endwith %}
    </td>

    <td class="h no-padding dont-touch-me">
        {% include "target/targets-line-note.html" %}
    </td>

    <td class="g dont-touch-me">
        {% if target.status.0 != "O" %}
            <i class="fas fa-fist-raised not-okay" title="Can't attack target"></i>
        {% else %}
            <a href="https://www.torn.com/loader2.php?sid=getInAttack&user2ID={{targetId}}" target="_blank" alt="attack"><i class="fas fa-fist-raised" title="Attack target"></i></a>
        {% endif %}
    </td>
        <!-- <a href="https://www.torn.com/profiles.php?XID={{targetId}}" target="_blank" alt="profile"><i class="fas fa-user" title="Target profile"></i></a> - -->
    <!-- <td class="g">
        <form style="display: inline;">{% csrf_token %}
            <a class="target-list-toggle" href={% url 'target:refresh' targetId %}>
               <i class="fas fa-sync-alt" title="Refresh target"></i>
            </a>
        </form>
    </td> -->
    <td class="g dont-touch-me">
        <!-- delete -->
        <form style="display: inline;">{% csrf_token %}
            <a class="target-list-delete" href={% url 'target:delete' targetId %}><i class="fas fa-trash-alt" title="Delete target"></i></a>
        </form>
    </td>


{% endif %}
