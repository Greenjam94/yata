<!DOCTYPE html>
{% load static %}
{% load i18n %}
{% load humanize %}
{% load mathfilters %}
{% get_current_language as LANGUAGE_CODE %}

<!-- Current language: {{ LANGUAGE_CODE }} -->
<html lang="{{ LANGUAGE_CODE }}">
<head>

    <!-- load jquery from https://code.jquery.com/ -->
    <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>

    <!-- load fontawsome from  -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">

    <!-- css -->
    <link rel="stylesheet" type="text/css" href={% static "admin/css/base.css" %} />
    <link rel="stylesheet" type="text/css" href={% static "admin/css/forms.css" %} />
    <link rel="stylesheet" type="text/css" href={% static "perso/css/base.css" %} />

    <!-- jquery module to sort tables from http://tablesorter.com -->
    <script type="text/javascript" src={% static "perso/js/jquery.tablesorter.min.js" %}></script>

    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

    <!-- scripts jquery perso -->
    <script>

        $(document).on('click', '#toggle-zero-hits', function(e){
            e.preventDefault();
            $(".zero-hits").slideToggle('fast', function() {});
            $(".zero-hits").promise().done(function() {
                var icon = $("#zero-hits-icon");
                if (icon.hasClass("fas fa-toggle-on")) {
                    icon.removeClass("fas fa-toggle-on");
                    icon.addClass("fas fa-toggle-off");
                } else {
                    icon.removeClass("fas fa-toggle-off");
                    icon.addClass("fas fa-toggle-on");
                }
            });
        });

        $(document).on('click', '#toggle-kicked-members', function(e){
            e.preventDefault();
            $(".kicked-members").slideToggle('fast', function() {});
            $(".kicked-members").promise().done(function() {
                var icon = $("#kicked-members-icon");
                if (icon.hasClass("fas fa-toggle-on")) {
                    icon.removeClass("fas fa-toggle-on");
                    icon.addClass("fas fa-toggle-off");
                } else {
                    icon.removeClass("fas fa-toggle-off");
                    icon.addClass("fas fa-toggle-on");
                }
            });
        });

        $(document).on('click', '.update-key', function(e){
            e.preventDefault();
            var key = $("#key-value").val();
            var check = $("#key-check-remember").is(':checked');
            var csrf = document.getElementsByName('csrfmiddlewaretoken')[0].value;
            $( "#api-key" ).html('<h2 class="title">Connecting to API</h2><div class="module whiteBG justTxt"><img src="https://www.torn.com/images/v2/main/ajax-loader.gif" alt="loader"/></div>');
            $( "#api-key" ).load( "{% url 'chain:updateKey' %}", {
                keyValue: key,
                html: "login",
                rememberSession: check,
                csrfmiddlewaretoken: csrf,
            });
        });

        // refresh members
        $(document).on('click', '#chain-members-refresh', function(e){
            e.preventDefault();
            var reload = $("#chain-members-reload");
            reload.html('<div class="loader"><img src="https://www.torn.com/images/v2/main/ajax-loader.gif" alt="loader"/></div>');
            reload.load( "{% url 'chain:createMembers' %}", {
                html: "members_reload",
                csrfmiddlewaretoken: document.getElementsByName('csrfmiddlewaretoken')[0].value,
            });
        });

        // refresh chain list
        $(document).on('click', '#chain-list-refresh', function(e){
            e.preventDefault();
            var reload = $("#chain-list-reload");
            reload.html('<div class="loader"><img src="https://www.torn.com/images/v2/main/ajax-loader.gif" alt="loader"/></div>');
            reload.load( "{% url 'chain:createList' %}", {
                html: "list_reload",
                csrfmiddlewaretoken: document.getElementsByName('csrfmiddlewaretoken')[0].value,
            });
        });

        // refresh report from report button
        $(document).on('click', '#chain-report-refresh', function(e){
            e.preventDefault();
            var reload = $("#chain-report-reload");
            var chainId = $("#chain-report-id").val();
            reload.html('<div class="loader"><img src="https://www.torn.com/images/v2/main/ajax-loader.gif" alt="loader"/></div>');
            reload.load( "/chain/createReport/"+chainId, {
                html: "report_reload",
                chainId: chainId,
                csrfmiddlewaretoken: document.getElementsByName('csrfmiddlewaretoken')[0].value,
            });
        });

        // refresh/create report from list button
        $(document).on('click', '.chain-report-refresh-list', function(e){
            e.preventDefault();
            var chainId = this.href.split("/").pop();;
            var reload = $("#catch-buttons-"+chainId);
            reload.html('<img src="https://www.torn.com/images/v2/main/ajax-loader.gif" alt="loader"/>');
            reload.load( "/chain/createReport/"+chainId, {
                html: "list_reload_buttons",
                chainId: chainId,
                csrfmiddlewaretoken: document.getElementsByName('csrfmiddlewaretoken')[0].value,
            });
        });

        // toggle report from list button
        $(document).on('click', '.chain-report-toggle-list', function(e){
            e.preventDefault();
            var chainId = this.href.split("/").pop();;
            var reload = $("#catch-buttons-"+chainId);
            reload.html('<img src="https://www.torn.com/images/v2/main/ajax-loader.gif" alt="loader"/>');
            reload.load( "/chain/toggleReport/"+chainId, {
                html: "list_reload_buttons",
                chainId: chainId,
                csrfmiddlewaretoken: document.getElementsByName('csrfmiddlewaretoken')[0].value,
            });
        });

        // toggle faction key
        // $(document).on('click', '.faction-key-toggle', function(e){
        //     e.preventDefault();
        //     var reload = $("#faction-key");
        //     reload.html('<img src="https://www.torn.com/images/v2/main/ajax-loader.gif" alt="loader"/>');
        //     reload.load( "{% url 'chain:toggleFactionKey' %}", {
        //         html: "faction_key_reload",
        //         csrfmiddlewaretoken: document.getElementsByName('csrfmiddlewaretoken')[0].value,
        //     });
        // });


        // show individual report
        $(document).on('click', '.chain-ireport', function(e){
            e.preventDefault();
            var splt = this.href.split("/");
            var memberId = splt.pop();
            var chainId = splt.pop();
            var reload = $("#individal-report-"+memberId);
            reload.html('<td colspan="10" style="text-align: center;"><img src="https://www.torn.com/images/v2/main/ajax-loader.gif" alt="loader"/></td>');
            reload.load( "/chain/createIndividualReport/"+chainId+"/"+memberId, {
                html: "ireport_reload",
                csrfmiddlewaretoken: document.getElementsByName('csrfmiddlewaretoken')[0].value,
            });
        });

    </script>


    <!-- favicon -->
    <link rel="icon" type="image/png" href={% static "images/items/268/small.png" %} />

    <!-- meta  -->
    <meta name="robots" content="NONE,NOARCHIVE" />
    <meta charset="UTF-8">

    <title>Yet Another Torn App</title>
</head>

<body>
    <div id="details"></div>

    <div id="container">
        <div id="content">
            <h1><b>Y</b>et <b>A</b>nother <b>T</b>orn <b>A</b>pp</h1>
            <p><b>Chain reports</b>: who's been a good chainer?</p>
            <br />

            <div id="api-key">
                {% include "chain/login.html" %}
            </div>


            {% if view.liveReport %}
                {% include "chain/live.html" %}
            {% endif %}

            {% if view.report %}{% include "chain/report.html" %}{% endif %}

            {% if view.jointReport %}
                {% include "chain/jreport.html" %}
            {% endif %}

            {% if view.list %}{% include "chain/list.html" %}{% endif %}

            {% if view.members %}{% include "chain/members.html" %}{% endif %}

            {% if view.tree %}
                <div id="chain-tree">
                    {% include "chain/tree.html" %}
                </div>
            {% endif %}

            {% if view.liveReport %}
                {% include "chain/faction_key.html" %}
            {% endif %}

        </div> <!--end of content-->
    </div> <!--end of container-->
</body>
</html>
